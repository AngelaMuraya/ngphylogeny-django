{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block nav-analysis %}class="active"{% endblock %}
{% block stylesheet %}
<script src="{% static 'js/jquery.filer.min.js' %} "></script>
<link rel="stylesheet" href="{% static 'css/jquery.filer.css' %}"/>
<script>
    $(document).ready(function () {
        var myInputFile = $(':file');
        var myInputFilename = myInputFile.attr('name');
        myInputFile.filer({
            showThumbs: true,
            changeInput: true,
        });
        myInputFile.attr({name: myInputFilename});
    });




</script>
{% endblock %}
{% block content %}
<script>
$(function() {
  $(".nav.nav-pills li").on("click", function() {
    $(".nav.nav-pills li").removeClass("active");
    $(this).addClass("active");
    $('.miniworkflow').addClass("hidden");
    $($(this).find('a').attr('id')).removeClass("hidden");
    $('form').attr('action', $(this).find('a').attr('id').replace("#", ''));
    $('#more_info').attr('href', $(this).find('a').attr('id').replace("#", ''))
  });
});




</script>
<h3>One Click Workflows</h3>
<div class="row">

    <div class="col-md-2">
        <h5>Workflow steps overview</h5>
        <a id='more_info' class="btn btn-default" href="{{ workflow_list.0.slug }}"><span
                class="glyphicon glyphicon-question-sign"></span> More detail</a>
    </div>

    <div class="col-md-10">
        {% for workflow in workflow_list|dictsort:"name" %}
        <table id="{{ workflow.slug }}" class="table-responsive miniworkflow
            {% if not forloop.first %}hidden{%endif%}">
            <tr>
                <td class="d-inline-block">
                    <div class="panel-group">
                        <div class="panel panel-info">
                            <div class="panel-heading"></div>
                            <div class="panel-body">
                                Input data
                            </div>
                        </div>
                    </div>
                </td>
                <td class="d-inline-block align-middle text-center">
                    <span class="glyphicon glyphicon-arrow-right"></span>
                </td>
                {% for step, tool in workflow.detail %}
                <td class="d-inline-block">
                    <div class="panel-group">
                        <div class="panel panel-default">
                            <div class="panel-heading">{{ tool.toolflag_set.first|default_if_none:"" }}</div>
                            <div class="panel-body">
                                <a data-toggle="collapse" href="#collapse-{{ step }}-{{ workflow.slug }}"><span
                                        class="glyphicon glyphicon-info-sign"></span></a> {{ tool.name }}
                            </div>
                            <div id="collapse-{{ step }}-{{ workflow.slug }}" class="panel-collapse collapse">
                                <div class="panel-footer">
                                    {{ tool.description }}
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                {% if not forloop.last %}
                <td class="d-inline-block align-middle text-center">
                    <span class="glyphicon glyphicon-arrow-right"></span>
                </td>
                {% endif %}
                {% endfor %}
            </tr>
        </table>
        {% endfor %}
    </div>
</div>
<div class="row row-eq-height">
    <div class="col-md-3 sidenav">
        <br>
        <ul class="nav nav-pills nav-stacked">
            <h4>One click workflow list:</h4>
            <hr/>
            {% for workflow in workflow_list|dictsort:"name" %}
            <li {% if forloop.first %}class="active" {%endif%}>
                <a id="#{{ workflow.slug }}">
                    <span class="glyphicon glyphicon-cog"></span>
                    {{ workflow.name }}
                </a>
            </li>
            {% endfor %}
        </ul>
        <br>
    </div>
    <div class="col-md-6">
        <form name="form" action="{{ workflow_list.0.slug }}" method="POST" enctype="multipart/form-data">
            <h4>Select an input file</h4>
            <div class="panel panel-info">
                <div class="panel-heading">Input Data</div>
                <div class="panel-body">
                    {% csrf_token %}
                    <input id="id_file" type="file" name="file" required="" multiple="multiple">
                    <input id="submit-id" type="submit" name="submit" value="Submit" class="btn btn-primary">

                </div>
            </div>
        </form>
        <h4>OR</h4>
        <form name="form2" action="{{ workflow_list.0.slug }}" method="POST">
            {% csrf_token %}
            <div class="panel panel-info">
                <div class="panel-heading">Paste yours sequences (Fasta format)</div>
                <div class="panel-body">
                    <div class="form-group">
                        <textarea id="id_text" class="form-control" name="pasted_text" required="" rows="5"></textarea>
                    </div>
                    <input id="submit-id-text" type="submit" name="submit" value="Submit"
                           class="btn btn-primary">
                </div>
            </div>


        </form>
    </div>
</div>

{% endblock content %}
